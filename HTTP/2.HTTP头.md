## 5. header

HTTP 的一些规则：

1. HTTP Header 名称不区分大小写。因此 `Content-Type` 与 `content-type` 并无差别
2. HTTP Header 名称与值由 `:` 分割，值首部空格将被忽略，更严格地说，是被 `/:\s+/` 分割。因此 `A: 3` 与 `A:    3` 并无差别
3. HTTP Header 中的非标准自定义首部由 `X-` 作为前缀，虽[已被废弃](https://datatracker.ietf.org/doc/html/rfc6648)，但仍然有大量使用。比如 `X-Powered-By`，仍被大量服务器框架所使用

HTTP Header 虽然不区分大小写，但有时也希望获取到原始的 Header，因此在 Node.js 中提供了两个 API：

1. [message.headers](https://nodejs.org/api/http.html#messageheaders)：对头部全部转化为小写形式返回
2. [message.rawHeaders](https://nodejs.org/api/http.html#messagerawheaders)：对头部不做大小写转化进行返回

**pseudo-header (伪头)**

- 在 HTTP/2 协议中，以 `:` 开头，被称为伪头，他们用于传递 HTTP 报文初识行数据

![image-20221020162120237](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20221020162120237.png)

有以下 4+1 个伪头，其中四个用于请求，一个用于响应。

- `:authority`，同 Host
- `:method`，同 METHOD
- `:path`，同 PATH
- `:scheme`，同 SCHEME，即 HTTPS/HTTP
- `:status`，同 Status Code

```bash
$ curl "http://httpbin.org/headers" -H "A: 3" -H "b:    4"
{
  "headers": {
    "A": "3",
    "Accept": "*/*",
    "B": "4",
    "Host": "httpbin.org",
    "User-Agent": "curl/7.55.1",
    "X-Amzn-Trace-Id": "Root=1-63510cfc-71480410204166cb3498023c"
  }
}
```

**作业**

1. HTTP 响应头中 `Cache-Control`，有时为首字母大写，有时为小写，哪个是正确写法

   HTTP Header 名称不区分大小写。因此 Cache-Control 与 cache-control 并无差别

2. 什么是伪头

3. 如何自定义 HTTP 头部

   - 避免和标准的 header 重名，用 `-` 连接单词
   - HTTP Header 中的非标准自定义首部由 X- 作为前缀，虽已被废弃，但仍然有大量使用

4. 观察自己常逛网站的 HTTP 请求头与响应头

5. 通过 `curl` 与 `httpbin` 测试请求头部

   `curl url -H "key: value"`

## 6. 请求头列表

**控制相关**

- `Host`：一般一个 IP 地址对应 N 个应用，通过 `Host` 即可定位到对应的应用
- `Cache-Control`：发送请求时，如何控制客户端的缓存策略
- `Expect`：与 100 状态码相关
- `Range`：指定范围请求，与 206 状态码相关

**条件相关**

条件请求相关头部，前两者与 304 状态码相关，`If-Range` 与 206 状态码相关

- `If-Match`
- `If-Modified-Since`
- `If-Range`

**内容协商**

- 内容协商，告知服务器端我需要什么样的资源，比如语言以及压缩编码，如果服务器无法返回对应的资源，则返回 406(Not Acceptable) 状态码

![img](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/httpnegoserver.png)

- `Accept`：我（客户端）需要什么样的资源，比如 json 与 html
- `Accept-Encoding`：我需要什么样的压缩编码，比如 gzip 与 br，如果不配置则可能不进行压缩
- `Accept-Language`：我需要什么样的语言，比如 en-US 和 zh-CN

**认证相关**

- `Authorization`：每次发送请求时，使用该头部携带 token 信息，维护客户端的认证状态

**来源相关**

通过来源相关，我们可以更好地统计用户信息，也可以以此为依据用来防止爬虫。

- `Referer`：当前页面的上一个页面是哪里，或者说该页面是由哪个页面跳转而来的
- `User-Agent`：用户代理是什么，或者说该页面是由哪个客户端（比如浏览器版本号之类）跳转而来的

**作业**

1. 浏览常见网站，打开浏览器控制台网络面板，查看其请求头

   [https://www.zhihu.com/signin](https://www.zhihu.com/signin)

   ![image-20221020172834931](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20221020172834931.png)

## 7. 响应头列表

**控制相关**

- `Date`：HTTP 报文**在源服务器产生的时间**
- `Age`：HTTP 报文在缓存服务器，比如 CDN 中的存储时间，以秒作为单位。一般来说，当前时间减去 `Date`，大约就是 `Age` 的秒数
- `Cache-Control`：HTTP 缓存策略，后续讲到，与 304 状态码相关
- `Location`：新建资源与重定向资源的路径，与 201/30x 状态码相关
- `Vary`：一般作为缓存的键（key），与内容协商相关。如 `vary: Accept-Encoding`

**条件相关**

以下均与缓存策略相关，将在后续文章重点讲到

- `ETag`：`Entity Tag`，用以标志实体的唯一性，与缓存策略 304 状态码相关
- `Last-Modified`：资源上次修改时间，与缓存策略 304 状态码相关

**作业**

1. `Date` 与 `Age` 响应头代表什么意思

2. 浏览常见网站，打开浏览器控制台网络面板，查看其响应头

   [https://www.zhihu.com/signin](https://www.zhihu.com/signin)

   ![image-20221020173437644](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20221020173437644.png)
