## 1. HTTP 报文

HTTP，`Hyper Text Transfer Protocol` 简写，超文本传输协议。在前端最重要的体现在于，浏览器（HTTP Client）与服务器（HTTP Server）之间的通信

**HTTP 报文**

- `HTTP Message` 也叫 HTTP 报文，用于在客户端与服务器间传送数据
- `HTTP` 由请求（`Request`）及响应（`Response`）构成

```bash
# 首行由 Method Path Version 构成
# 每一行结尾是 \r\n
GET / HTTP/1.1
# 以下是请求头，Host 是请求的域名
Host: www.baidu.com
User-Agent: curl/7.79.1
Accept: */*

# 响应报文
# 相隔两个 \r\n，将会收到响应报文

# 首行由 Version StatusCode StatusText 组成
# 一般在 HTTP/2 中，没有 StatusText
HTTP/1.1 200 OK
# 以下是响应头
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 2443
Content-Type: text/html
Date: Wed, 31 Aug 2022 09:23:42 GMT
Etag: "58860402-98b"
Last-Modified: Mon, 23 Jan 2017 13:24:18 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
Set-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/

# 响应体
# 相隔两个 \r\n，将会收到响应体
<!DOCTYPE html>
...
```

**LF 与 CRLF 区别**

- **`\r`** = CR (Carriage Return) → Used as a new line character in Mac OS before X
- **`\n`** = LF (Line Feed) → Used as a new line character in Unix/Mac OS X
- **`\r\n`** = CR + LF → Used as a new line character in Windows
- 简单而言，现在除了 `Windows` 把 `\r\n` 作为换行符，其他系统都是把 `\n` 作为了换行符

```bash
$ echo -e "\r\n" | cat -e
^M$
```

**HTTP Client/Serve**

HTTP 由请求以及响应组成，负责请求的被称为 `HTTP Client`，即 HTTP 客户端，而负责响应的被称为 `HTTP Server`，即 HTTP 服务器端

- 在后端中，他们的 `nginx/django/express/koa` 等，便是扮演 HTTP 服务器端的角色，**接收 HTTP 客户端的请求，分析路由、请求方法请求体，并返回对应的响应报文**
- 在前端中，浏览器便是扮演 HTTP 客户端的角色，从代码层面来说，我们使用的 `fetch`/`axios` 就是 HTTP 客户端，各种编程语言的请求库以及 `curl` 都可以视为 HTTP 客户端

**作业**

1. 什么是 `\r\n`

   `\r \n` 都是换行符，只不过不同的操作系统换行符不同。而互联网为了保证其适用性，索性将 `\r\n` 放在每一行结尾

2. 如何找到文件中的 `\r\n`

   - 在 vim 中可以使用 `:set list`
   - 使用`cat -e` 代表显示不可打印字符与换行符
   - 在 bat 中可以使用 `bat -Ap` 文件名 命令将换行符显示出来。（`-A`：显示不可见字符，`-p`：显示纯文本，不显示行号）

3. HTTP 报文格式是什么样的

4. 我们如何查看某次请求的 HTTP 报文

   `curl -v  网址` 命令来查看完整报文



## 2.报文模拟

nc（`netcat` 的简称）以及 `telnet` 能够连接 TCP/UDP 端口号与其通信，也可以用于端口连通性测试

一般而言，HTTP 默认监听的是 80 端口，我们可通过 `nc` 与网站的 80 端口直接通过 HTTP 报文进行通信

```bash
$ nc httpbin.org 80
GET /get HTTP/1.1
Host: httpbin.org

HTTP/1.1 200 OK
Date: Wed, 21 Sep 2022 07:16:25 GMT
Content-Type: application/json
Content-Length: 200
Connection: keep-alive
Server: gunicorn/19.9.0
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true

{
  "args": {}, 
  "headers": {
    "Host": "httpbin.org"
  }, 
  "url": "http://httpbin.org/get"
}
```

通过 `telnet` 同样可以达到效果

```bash
$ telnet httpbin.org 80
Trying 18.207.88.57...
Connected to httpbin.org.
Escape character is '^]'.
GET /get HTTP/1.1
Host: httpbin.org

HTTP/1.1 200 OK
Date: Wed, 21 Sep 2022 07:22:36 GMT
Content-Type: application/json
Content-Length: 200
Connection: keep-alive
Server: gunicorn/19.9.0
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true

{
  "args": {}, 
  "headers": {
    "Host": "httpbin.org"
  }, 
  "url": "http://httpbin.org/get"
}
```

**作业**

1. 安装 nc/telnet 命令行工具
2. 通过 nc/telnet 使用 HTTP 报文与网站进行通信

## 3. Chrome Devtools

打开 Chrome 浏览器，快捷键 `<Control-Shift-I>` 或者 `<Command-Shift-I>` 可打开控制台网络面板

在网络面板中，右键，点击 `Header Options`，可网络面板中显示更多选项列，建议添加以下选项

- `Protocol`：HTTP 协议版本号
- `Content-Length`：响应体大小
- `Content-Encoding`：响应体编码

![image-20221018173120469](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20221018173120469.png)

在筛选条的最左侧，有筛选文本输入框，可对资源进行筛选

![image-20221018173621980](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20221018173621980.png)

1. `/[cj]s/`，直接输入正则表达式对资源进行筛选
2. `domain:<domain>`，根据域名进行筛选
3. `method`：根据请求方法进行筛选
4. `status-code`：根据状态码进行筛选，**另它会自动补充所有资源的状态码，可查看该网站资源有多少状态码**
5. `larger-than:<size>`：筛选大于指定体积的资源，如 `larger-than:100k`
6. `has-response-header:<header>`，可对是否包含某响应头进行筛选，如 `has-response-header:cache-control`
7. `mime-type`：根据指定 MIME 类型进行筛选

![image-20221018174003002](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20221018174003002.png)

1. 打开网络面板控制台后，有 126 个请求
2. 打开网络面板控制台后，有 1.9MB 资源进行了传输，未压缩时体积 2.8MB，压缩后为 1.9MB

![image-20221018174039174](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20221018174039174.png)

在控制台中，也可以通过以上配置显示每条资源压缩前和解压后的体积

**作业**

1. 在开发环境调试 HTTP 请求时，如何只筛选出 `localhost` 上的所有请求

   `domain:localhost`

2. 控制台左下角，`transformed size` 与 `resource size` 有何区别

   - `transformed size`：代表压缩后的传输内容体积
   - `resource size`：代表未压缩时的体积

3. 如何看出某个网站首页加载了多少个请求

   在 Network 选项卡中，查看左下角的 requests 数量

4. 如何在控制台中显示 HTTP 协议一列

   在 Network 选项卡中，右击选择 Header Options 之后勾选 Protocol

## 4. curl

`curl`，用于发送请求的命令行工具，一个 HTTP 请求客户端（实际上它也可以做 FTP/SCP/TELNET 协议的事情）。可类比于浏览器中的 fetch

```bash
$ curl ifconfig.me
61.237.228.3
```

除此之外，还有一些常见选项：

- `-X/--request`：指定请求方法
- `-I/--head`：发送 HEAD 请求
- `-H/--header`：指定请求头
- `-d/--data`：指定请求体

**curl --request**

- `--request/-X`，指定请求方法，如 `POST`/`GET` 等方法，默认为 `GET` 请求

```bash
$ curl https://httpbin.org/post -X POST -H "a: 3" -H "b: 4"
{
  "args": {},
  "data": "",
  "files": {},
  "form": {},
  "headers": {
    "A": "3",
    "Accept": "*/*",
    "B": "4",
    "Host": "httpbin.org",
    "User-Agent": "curl/7.55.1",
    "X-Amzn-Trace-Id": "Root=1-634e76f7-5fa0ae6746ba105e7ca5bd82"
  },
  "json": null,
  "origin": "61.237.228.3",
  "url": "https://httpbin.org/post"
}
```

**curl --head**

- `--head/-I` 发送 HEAD 请求，只会返回 Response Header

```bash
$ curl --head https://shanyue.tech
HTTP/2 200
server: Tengine
content-type: text/html; charset=utf-8
content-length: 33229
vary: Accept-Encoding
date: Tue, 21 Jun 2022 05:54:24 GMT
vary: Accept-Encoding
x-oss-request-id: 62B15D1050ED1C32320FE906
x-oss-cdn-auth: success
accept-ranges: bytes
etag: "F540C0D57CDB57215AF11970EF4AAEF6"
last-modified: Wed, 23 Mar 2022 14:57:44 GMT
x-oss-object-type: Normal
x-oss-hash-crc64ecma: 8545542358272103335
x-oss-storage-class: Standard
x-oss-meta-mtime: 1648047444.796073379
cache-control: no-cache
content-md5: 9UDA1XzbVyFa8Rlw70qu9g==
x-oss-server-time: 27
ali-swift-global-savetime: 1655790864
via: cache12.l2cn3051[290,290,200-0,M], cache4.l2cn3051[291,0], kunlun6.cn3145[383,382,200-0,M], kunlun3.cn3145[386,0]
x-cache: MISS TCP_MISS dirn:-2:-2
x-swift-savetime: Tue, 21 Jun 2022 05:54:24 GMT
x-swift-cachetime: 0
timing-allow-origin: *
eagleid: 791d26a916557908641262834e
```

**curl --include**

- `--include/-i`，打印 Response Header 与 Response Body

```bash
HTTP/1.1 200 OK
access-control-allow-origin: *
content-type: text/plain; charset=utf-8
content-length: 15
date: Wed, 17 Aug 2022 01:56:20 GMT
x-envoy-upstream-service-time: 1
strict-transport-security: max-age=2592000; includeSubDomains
server: istio-envoy
Via: 1.1 google

222.222.222.113%
```

**curl --verbose**

- `--verbose/-v`，查看发送报文及 TLS handshake 的详细

```bash
$ curl -vvv --head https://shanyue.tech
```

**curl --location**

- `--location/-L`，追踪重定向

```bash
# 重定向两次后请求到数据
$ curl --location http://zhihu.com

# 可使用 --head，查看到三次响应
$ curl --head --location http://zhihu.com
```

**httpie && examples**

- [httpie](https://httpie.io/) 是现代化更为流行的一个 HTTP 客户端，支持色彩、JSON 等

```bash
# 发送 JSON 数据给服务器端，httpie 比 curl 方便很多，不需要自己手写 header，curl 默认为 application/x-www-form-urlencoded
$ http POST httpbin.org/post "a: 3" name=shanyue
$ curl -X POST httpbin.org/post -H "a: 3" -H "content-type: application/json" -d '{"name": "shanyue"}'

# 发送 Form 数据给服务器端，curl/httpie 都比较方便
$ http -f POST httpbin.org/post "a: 3" name=shanyue
$ curl -X POST httpbin.org/post -H "a: 3" -d name=shanyue

# 上传文件
$ http POST httpbin.org/post < Readme.md
$ curl -X POST httpbin.org/post -H "content-type: application/json" -d @Readme.md

# multipart 上传文件
$ http --multipart httpbin.org/post a=3 b@'Readme.md'
```

curl 网站

```bash
$ curl --head -L http://zhihu.com
HTTP/1.1 301 Moved Permanently
Location: https://www.zhihu.com/

HTTP/1.1 302 Found
location: //www.zhihu.com/signin?next=%2F

HTTP/1.1 200 OK
Content-Length: 37670
```

**作业**

1. curl/httpie 如何发送一个 GET 请求

   `curl -X get www.baidu.com`

2. curl/httpie 如何发送 JSON 数据给服务器端

   `curl https://httpbin.org/post -X POST -H "content-type: application/json" -d {"a: 1"}`

3. curl/httpie 如何发送 FORM 数据给服务器端

   `curl https://httpbin.org/post -X POST -d a=1`

4. curl/httpie 如何追踪重定向路径

   `curl --location http://zhihu.com`

5. curl/httpie 如何仅返回 Response Header

   `curl --head https://shanyue.tech`
