# Kubernetes基础

## k8s是什么

> [https://kubernetes.io/docs/concepts/overview/](https://kubernetes.io/docs/concepts/overview/)

![image-20240202104122296](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240202104122296.png)

1. 传统部署时代
2. 虚拟化部署时代
3. 容器部署时代

> 如果部署很多容器，管理起来就很麻烦了，我们急需一个大规模容器编排系统

Kubernetes 为你提供：

- **服务发现和负载均衡**

  Kubernetes 可以使用 DNS 名称或自己的 IP 地址来暴露容器。 如果进入容器的流量很大， Kubernetes 可以负载均衡并分配网络流量，从而使部署稳定。

- **存储编排**

  Kubernetes 允许你自动挂载你选择的存储系统，例如本地存储、公共云提供商等。

- **自动部署和回滚**

  你可以使用 Kubernetes 描述已部署容器的所需状态， 它可以以受控的速率将实际状态更改为期望状态。 例如，你可以自动化 Kubernetes 来为你的部署创建新容器， 删除现有容器并将它们的所有资源用于新容器。

- **自动完成装箱计算**

  你为 Kubernetes 提供许多节点组成的集群，在这个集群上运行容器化的任务。 你告诉 Kubernetes 每个容器需要多少 CPU 和内存 (RAM)。 Kubernetes 可以将这些容器按实际情况调度到你的节点上，以最佳方式利用你的资源。

- **自我修复**

  Kubernetes 将重新启动失败的容器、替换容器、杀死不响应用户定义的运行状况检查的容器， 并且在准备好服务之前不将其通告给客户端。

- **密钥与配置管理**

  Kubernetes 允许你存储和管理敏感信息，例如密码、OAuth 令牌和 SSH 密钥。 你可以在不重建容器镜像的情况下部署和更新密钥和应用程序配置，也无需在堆栈配置中暴露密钥。

- **批处理执行** 除了服务外，Kubernetes 还可以管理你的批处理和 CI（持续集成）工作负载，如有需要，可以替换失败的容器。
- **水平扩缩** 使用简单的命令、用户界面或根据 CPU 使用率自动对你的应用进行扩缩。
- **IPv4/IPv6 双栈** 为 Pod（容器组）和 Service（服务）分配 IPv4 和 IPv6 地址。
- **为可扩展性设计** 在不改变上游源代码的情况下为你的 Kubernetes 集群添加功能。

Kubernetes 提供了一个可弹性运行分布式系统的框架。Kubernetes 会满足你得扩展要求、故障转移、部署模式等。例如：Kubernetes 可以轻松管理系统的 Canary 部署（金丝雀部署、灰度部署）

## 架构

### 工作方式

Kubernetes Cluster = N Master Node + N Worker Node（N主节点+N工作节点；N>=1）

### 组件架构

> [https://kubernetes.io/zh-cn/docs/concepts/overview/components/](https://kubernetes.io/zh-cn/docs/concepts/overview/components/)

![image-20240202142220308](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240202142220308.png)

#### 控制平面组件（总部）

`Control Plane Components`

控制平面组件会为集群做出全局决策，比如资源的调度。 以及检测和响应集群事件，例如当不满足部署的 `replicas` 字段时，要启动新的 Pod

**kube-apiserver**（秘书）

API 服务器是 Kubernetes 控制平面的组件， 该组件负责公开了 Kubernetes API，负责处理接受请求的工作。 API 服务器是 Kubernetes 控制平面的前端

**etcd**（资料库）

一致且高可用的键值存储，用作 Kubernetes 所有集群数据的后台数据库

**kube-scheduler**（调度者）

`kube-scheduler` 是控制平面的组件， 负责监视新创建的、未指定运行节点（node）的 Pods， 并选择节点来让 Pod 在上面运行

**kube-controller-manager**（决策者）

kube-controller-manager 是控制平面的组件， 负责运行控制器进程

**cloud-controller-manager**（外联部）

一个 Kubernetes 控制平面组件， 嵌入了特定于云平台的控制逻辑。云控制器管理器（Cloud Controller Manager） 允许将你的集群连接到云提供商的 API 之上， 并将与该云平台交互的组件同与你的集群交互的组件分离开来

#### Node组件（分厂）

**kubelet**（厂长）

`kubelet` 会在集群中每个节点（node）上运行。 它保证容器（containers）都运行在 Pod 中

**kube-proxy**（门卫大爷）

kube-proxy 是集群中每个节点（node）上所运行的网络代理， 实现 Kubernetes 服务（Service）概念的一部分

