## 拦截器

> [完整的Axios封装-单独API管理层、参数序列化、取消重复请求、Loading、状态码...](https://juejin.cn/post/6968630178163458084)

拦截器常用功能：

1. 封装实现配置化

2. 表单序列化（qs.stringify）

   表单序列化：`Content-Type: application/x-www-form-urlencoded`

3. 基础鉴权（jwt）

   无痛刷新Token：判断 Token 是否过期，没有过期正常处理。过期则发起刷新 Token 的请求，拿到新的 Token 进行保存，重新发送 Token 过期这段时间内发起的请求

   [前端无痛刷新Token](https://juejin.cn/post/7075348765162340383)

4. 接口报错捕获弹窗提示、报错重定向

5. 取消重复请求，两次重复请求间隔大于防抖时间（map、qs.stringify、cancelToken）

   场景：快速点击一个按钮（订单后端也会做幂等控制）、tab频繁切换

   [axios 拦截器配置重复请求取消](https://juejin.cn/post/7004721390767046686)

6. 全局 Loading

   [如何在 Axios 中去控制 Loading？大有学问！](https://mp.weixin.qq.com/s/R-drKObZrO2OOKiIKmj6MA)

   如果实现按钮 loading，需要给接口传入 ref 类

   - Axios 在接口调用传入的配置项和拦截器返回的配置项并不是同一个内存地址。ref 返回的对象是 RefImpl 类的实例，并不是普通的对象，Axios 深拷贝的时候没有处理该实例对象

7. 其他：国际化（Accpet-Language）、接口加解密

## 组件化

> [如何开发一个人人爱的组件?](https://mp.weixin.qq.com/s?__biz=MzUxNzk1MjQ0Ng==&mid=2247514450&idx=1&sn=318b462c6db6e2a1f2915fcf26e02305)

1. 注重 TypeScript API 定义

   - DOM 属性：className 可以使用 classnames 处理，data-xxx 可以直接对 props 类型做一个基础封装 `{ className?: string, style?: CSSProperties } & Record<'data-${string}', string>`
   - 类型注释：为组件暴露的类型添加规范的注释
   - 组件插槽：`{ label?: React.ReactNode }`
   - 受控于非受控：组件数据输入使用泛型规范
   - 表单类型、选择类型

2. 不应该引入副作用依赖，比如全局状态（Vuex、Redux）

3. 组件设计

   - 服务请求：很多场景来说，只是替换一下请求的 url
   - Hooks：对于业务组件需要传特殊参数可以使用 Hooks，保证逻辑高度复用性
   - Consumer：`({ isExpand }) => { return isExpand ? <Table /> : <AnotherTable /> }`

4. 文档设计

   注重 README 和 Mock

   注重 package.json 常见的入口定义，比如：main、module、types、exports

   ```json
   {
     "name": "xxx-ui",
     "version": "1.0.0",
     "description": "Out-of-box UI solution for enterprise applications from B-side.",
     "author": "yee.wang@xxx.com",
     "exports": {
       ".": {
         "import": "./dist/esm/index.js",
         "require": "./dist/cjs/index.js"
       }
     },
     "main": "./dist/cjs/index.js",
     "module": "./dist/esm/index.js",
     "types": "./dist/cjs/index.d.ts",
     "repository": {
       "type": "git",
       "url": "git@github.com:yee94/xxx.git"
     }
   }
   ```

## 多语言

多语言切换工作:

1. 模板中的内容