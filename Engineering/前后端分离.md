# 前后端分离

> [到底什么是前后端分离](https://blog.csdn.net/fuhanghang/article/details/119729232)
>
> [前后端分离架构概述](https://blog.csdn.net/fuzhongmin05/article/details/81591072)

## 基本概念

一般都是只有 Web 服务器才能被外网访问，应用服务器只能内网访问

- Web 服务器：一般指 Nginx、Apache 这类的服务器，一般只能解析静态资源
- 应用服务器：一般指 Tomcat、Jetty、Resin 这类的服务器，可以解析动态资源也可以解析静态资源，但解析静态资源的能力没有 Web 服务器好



浏览器不关心服务器端是 JSP（HTML代码里混入Java）、ASP、PHP，或是原始的 Servlet（Java 代码里混入 HTML），或是静态服务器上的 HTML，只要返回的是合法的 HTML 就可以

- ASP：Active Server Page。Java EE 现有的 Servlet，那是已经有了 ASP，Java 学习了 ASP，提出了 JSP
- JSP：Java Server Page，是运行在服务器端 JVM 之上 Servlet 容器里的，只是执行的结果是 HTML，响应给浏览器

把 JSP 中静态 HTML 部分拿出来，变成简单的 HTML 文件，放在 HTTP 服务器上，浏览器只要获取这些 HTML 即可，动态数据部分用 HTML 里的 JS 通过 AJAX 的方式从服务器端获取，然后动态操作 DOM，完成动态内容显示，这样前后端就分离了

## 未分离时代

早期主要使用 MVC 架构，JSP +Servlet 的结构图如下：

![image-20230523102638188](https://gitee.com/lilyn/pic/raw/master/md-img/image-20230523102638188.png)

所有的请求都被发送给作为控制器的 Servlet，它接收请求并根据请求信息将它们分发给适当的 JSP 来响应。同时，Servlet 还根据 JSP 的需求生成 JavaBeans 实例并输出给 JSP 环境

开发方式有如下两种：

![image-20230523103549086](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20230523103549086.png)

淘汰主要原因：

1. 前端在开发过程中严重依赖后端，在后端没有完成的情况下，前端根本无法干活
2. 由于趋势问题，会 JSP，懂 velocity，freemarker 等模板引擎的前端越来越少

## 半分离时代

前后端半分离，前端负责开发页面，通过接口（Ajax）获取数据，采用Dom操作对页面进行数据绑定，最终是由前端把页面渲染出来。这也就是 Ajax 与 SPA 应用（单页应用）结合的方式，其结构图如下：

![image-20230523103700724](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20230523103700724.png)

为什么说是半分离的？因为不是所有页面都是单页面应用，在多页面应用的情况下，前端因为没有掌握 controller 层，前端需要跟后端讨论，我们这个页面是要同步输出呢，还是异步 Json 渲染呢？而且，即使在这一时期，通常也是一个工程师搞定前后端所有工作。因此，在这一阶段，只能算半分离

这种架构下，有如下明显弊端：

1. JS 存在大量冗余，在业务复杂的情况下，页面的渲染部分的代码，非常复杂
2. 在 Json 返回的数据量比较大的情况下，渲染的十分缓慢，会出现页面卡顿的情况
3. SEO（Search Engine Optimization，即搜索引擎优化）非常不方便，由于搜索引擎的爬虫无法爬下 JS 异步渲染的数据，导致这样的页面，SEO 会存在一定的问题
4. 资源消耗严重，在业务复杂的情况下，一个页面可能要发起多次 HTTP 请求才能将页面渲染完毕

## 分离时代

大家一致认同的前后端分离的例子就是 SPA（Single-page application），所有用到的展现数据都是后端通过异步接口（AJAX/JSONP）的方式提供的，前端只管展现。从某种意义上来说，SPA确实做到了前后端分离，但这种方式存在两个问题：

1. WEB 服务中，SPA 类占的比例很少。很多场景下还有同步/同步+异步混合的模式，SPA 不能作为一种通用的解决方案
2. 现阶段的 SPA 开发模式，接口通常是按照展现逻辑来提供的，而且为了提高效率我们也需要后端帮我们处理一些展现逻辑，这就意味着后端还是涉足了 view 层的工作，不是真正的前后端分离

SPA 式的前后端分离，从物理层做区分（认为只要是客户端的就是前端，服务器端就是后端）这种分法已经无法满足前后端分离的需求

- 前端负责 view 和 controller 层
- 后端只负责 model 层，业务处理与数据持久化等

可是服务端人员对前端 HTML 结构不熟悉，前端也不懂后台代码呀，controller 层如何实现呢？这就是 node.js 的妙用了，node.js 适合运用在高并发、I/O 密集、少量业务逻辑的场景。最重要的一点是，前端不用再学一门其他的语言了，对前端来说，上手度大大提高

![image-20230523104622776](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20230523104622776.png)

增加 node.js 作为中间层，具体有哪些好处呢？

1. 适配性提升；我们其实在开发过程中，经常会给 PC端、mobile、app 端各自研发一套前端。其实对于这三端来说，大部分端业务逻辑是一样的。唯一区别就是交互展现逻辑不同。如果 controller 层在后端手里，后端为了这些不同端页面展示逻辑，自己维护这些 controller，模版无法重用，徒增和前端沟通端成本
2. 响应速度提升；我们有时候，会遇到后端返回给前端的数据太简单了，前端需要对这些数据进行逻辑运算。那么在数据量比较小的时候，对其做运算分组等操作，并无影响。但是当数据量大的时候，会有明显的卡顿效果。这时候，node 中间层其实可以将很多这样的代码放入 node 层处理、也可以替后端分担一些简单的逻辑、又可以用模板引擎自己掌握前台的输出。这样做灵活度、响应度都大大提升
3. 性能得到提升；大家应该都知道单一职责原则。从该角度来看，我们，请求一个页面，可能要响应很多个后端接口，请求变多了，自然速度就变慢了，这种现象在 mobile 端更加严重。采用 node 作为中间层，将页面所需要的多个后端数据，直接在内网阶段就拼装好，再统一返回给前端，会得到更好的性能
4. 异步与模板统一；淘宝首页就是被几十个 HTML 片段（每个片段一个文件）拼装成，之前 PHP 同步 include 这几十个片段，一定是串行的，Node 可以异步，读文件可以并行，一旦这些片段中也包含业务逻辑，异步的优势就很明显了，真正做到哪个文件先渲染完就先输出显示。前端机的文件系统越复杂，页面的组成片段越多，这种异步的提速效果就越明显。前后端模板统一在无线领域很有用，PC 页面和 WIFI 场景下的页面适合前端渲染（后端数据 Ajax 到前端），2G、3G 弱网络环境适合后端渲染（数据随页面吐给前端），所以同样的模板，在不同的条件下走不同的渲染渠道，模板只需一次开发

![image-20230523105127365](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20230523105127365.png)
