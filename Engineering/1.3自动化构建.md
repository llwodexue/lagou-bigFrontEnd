## 自动化构建

**源代码 -> 生成代码**

![前端样式自动化构建](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/%E5%89%8D%E7%AB%AF%E6%A0%B7%E5%BC%8F%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA.png)

输入 `scss scss/main.scss css/style.css` 即可构建出 css

- 缺点：每次都需要重复输入这个复杂的命令

  npm script 就是用来解决这个问题

  ```json
  {
    "scripts": {
      "build": "sass scss/main.scss css/style.css --watch",
    },
  }
  ```

接下来安装 `browser-sync` 用于启动测试服务器

```bash
yarn add browser-sync --dev
```

运行测试服务器 `npm run serve`

- `--files` 监听文件变化

```json
{
  "scripts": {
    "serve": "browser-sync . --files \"css/*.css\"
  },
}
```

不过这里可能有个问题，如果在运行测试服务器之前，没有生成 css，浏览器就没办法展示样式

- 这里就可以用到 npm script 的钩子机制 `preserve` 在启动任务之前，让 build 先去工作

```json
{
  "scripts": {
    "preserve": "yarn build"
  },
}
```

如果给 build 增加 `--watch` 参数，scss 会阻塞命令行等待文件变化，就会导致 `browser-sync` 没办法直接去工作

- 这里就需要用 `npm-run-all` 同时执行多个命令

  ```bash
  yarn add npm-run-all --dev
  ```

```json
{
  "scripts": {
    "start": "run-p build serve"
  },
}
```

**常用工具**

- 严格来说 Webpack 是模块打包工具
- Grunt、Gulp、FIS 是自动化构建工具

![常用自动化构建工具](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/%E5%B8%B8%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.png)

- Grunt 老牌构建工具，插件生态完善，但是它的工作过程是基于临时文件实现的，所以构建速度较慢(Scss 编译后就会将结果写入到临时文件，下一个插件读取这个临时文件进行操作，环节越多读取文件次数越多)
- Gulp 基于内存实现的，对文件的处理都是在内存中实现，速度快一些，默认同时支持多个任务，目前比较流行
- FIS 百度团队研发，把项目中最典型需求都集成到内部，大而全

## Grunt 基本使用

```bash
yarn init –yes
yarn add grunt
```

新建 `gruntfile.js`

- Grunt 的入口文件，用于定义一些需要 Grunt 自动执行的任务
- 需要导出一个函数，该函数接收一个 grunt 对象，内部提供一些创建任务可以用到的 API