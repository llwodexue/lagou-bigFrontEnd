## 指令合并

![image-20240220143217389](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240220143217389.png)

1. 子配置不存在时，直接使用父配置块
2. 子配置存在时，直接覆盖父配置块

![image-20240220143531015](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240220143531015.png)

HTTP 模块合并配置的实现

![image-20240220153632520](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240220153632520.png)

## 接收HTTP 

![image-20240223110937709](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223110937709.png)

重定向 URI

![image-20240223110922014](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223110922014.png)

## HTTP请求11个阶段

![image-20240223111044011](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223111044011.png)

TCP 连接有 src ip，一条连接拿到 src ip 就可以判断用户 ip 地址了。但实际中间有反向代理，反向代理会导致与上游的机器建立新的 TCP 连接，上游服务器直接取 src ip 是有没有颁发拿到真实 ip 的

![image-20240223111520614](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223111520614.png)

Rewrite 模块

![image-20240223143651771](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223143651771.png)

## Location

![image-20240223144931598](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223144931598.png)

![image-20240223154252137](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223154252137.png)

## 限制并发

![image-20240223154606462](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223154606462.png)

![image-20240223160909993](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223160909993.png)

```nginx
http {
  limit_conn_zone $binary_remote_addr zone=addr:10m;
  server {
    listen 8084;
    server_name _;
    location / {
      root html;
      limit_conn_status 500;
      limit_conn_log_level warn;
      limit_rate 50;
      limit_conn addr 1;
    }
  }
}
```

如何限制某些 IP 地址的访问权限

```nginx
http {
  server {
    listen 8085;
    location / {
      allow 127.0.0.1;
      allow 192.168.1.0/24;
      deny all;
    }
  }
}
```

## autoindex

![image-20240223162053886](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223162053886.png)

## concat

![image-20240223163259749](https://gitee.com/lilyn/pic/raw/master/md-img/image-20240223163259749.png)