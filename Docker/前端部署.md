## 部署流程简述

我们通过 vue、react、ts 等编写的代码通过 webpack 进行打包，对于打包生成的静态资源可以分为两类：

- 不带 hash 值的静态资源

  可以设置 `cache-control: no-cache`，让其每次都去服务器请求数据

- 带 hash 值的静态资源

  可以设置 `cache-control: 31536000` 一年的缓存时间，从而利用 CDN 或浏览器的缓存

在进行构建打包时，也可以使用 webpack 进行优化，更小的体积就意味着更小的负载、更小的 IO 也意味着网站更快的加载

- contentHash

  chunkHash 里每一个 chunk，有可能包含 js 和 css（路径名有相同 hash），如果 css 代码改变，打包后的 js hash 名也会发生变更，这样就会重新去服务器请求资源，不是很好

- deterministic

  前端打包最终会生成很多 chunk，假设这些 chunk 都有一个 chunkId，一个 chunk 源码发生改变，就有可能影响到其他 chunk，其它 chunk 路径名发生变

- runtimeChunk

  webpack 打包会有一些运行时代码，基本上不会发生变更，就可以把它和其他的 chunk 去单独隔离开

- splitChunk

  对打包后的静态资源划分为多个 chunk，组件有代码发生变更只有它对应的 chunk 发生改变

- terser

  对静态资源进行压缩

我们可以使用 docker 对镜像进行优化

- 提高 docker 构建速度及生成镜像体积进行优化

在公司中一般会搭建一个私有的镜像仓库

- traefik 或 k8s 会拉取镜像将其部署

在使用 nginx 去构建时也有一些好处，比如前端单独配置 nginx.conf，并将其添加到前端镜像中

- 比如配置 cors、gzip/brotil、cache、location、rewrite、redirect

我们可以将静态资源推送到 oss

- 通过 CDN 对 oss 进行加速

我们还可以做 http 的优化

- hsts 将 http 直接转换成 https，无需重定向
- TLS v1.3 减少 TLS 握手次数
- oscp stapping 关于证书优化
- http2
- Brotli

持续集成

- 个人开发的分支在提交前在本地会做 Git Hooks 的处理（pre-commit、lint、commit-msg）

- 进行 CI 检查（Image 镜像安全性、Audit 依赖安全性、Bundle 打包的大小、Test、Lint）

- 代码提交到提交到功能分支并且推送到远程仓库，CI 会自动对我们的功能分支新建一个测试环境（feature-xxx.cra.ll.tech）

  如此依赖，测试人员就可以在功能分支的测试环境对我们代码进行测试

- Code Review 多个同事对代码没有异议就可以将它合并到主分支

- 如果部署失败或在新环境中发生 bug，就需要进行回滚 Rollback

![image-20220819181247769](E:\learn\lagouBigFront\md\Docker\img\image-20220819181247769.png)