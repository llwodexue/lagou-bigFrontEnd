## 小程序介绍

微信开发者工具 - 调试 - 调试微信开发者工具

![image-20231013144747241](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/image-20231013144747241.png)

调式 webview

```js
// 注意：这里不一定是第 0 个元素，也有可能是第 1 个元素
document.getElementsByTagName('webview')[0].showDevTools(true)
// $0 -> webview
$0.showDevTools(true)
```

### 优势

当微信中的 WebView 逐渐成为移动 Web 的⼀个重要入口时，微信就有相关的 JS-SDK 了

- JS-SDK 解决了移动网页能力不足的问题，通过暴露微信的接⼝使得 Web 开发者能够拥有更多的能⼒
- 但是 JS-SDK 的模式并没有解决使⽤移动网页遇到的体验不良的问题

小程序优势

1. 丰富的客户端能力

   提供了很多 API（H5上有的和没有的），前端用 JS SDK 形式去调用

2. 优良的离线性

### 小程序与普通网页区别

网页开发渲染线程和脚本线程是互斥的，这也是为什么长时间的脚本运行可能导致页面失去响应。而在小程序中，二者是分开的，分别运行在不同的线程中

网页开发者可以使用到各种浏览器暴露出来的 DOM API，进行 DOM 选中和操作

小程序的逻辑层和渲染层是分开的，**逻辑层采用 JSCore 运行 js 代码**，并没有一个完整浏览器对象。**渲染层使用 webview 进行渲染**

- 因而缺少相关的 DOM API 和 BOM API。这一区别导致了前端开发非常熟悉的一些库，例如 jQuery、Zepto 等，在小程序中是无法运行的
- 同时 JSCore 的环境同 NodeJS 环境也是不尽相同，所以一些 NPM 的包在一些小程序也是无法运行的

**双线程架构**

逻辑层、渲染层两个线程之间由 Native 层之间统一处理，无论是线程之间的通信，还是数据的传递，网络请求都是由 Native 层做转发

![img](https://gitee.com/lilyn/pic/raw/master/lagoulearn-img/f59dd6330bbc47e9af27a2a7e64b9cbftplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp)

## 小程序框架

### 小程序平台区别

微信⽂档：[https://developers.weixin.qq.com/miniprogram/dev/api/](https://developers.weixin.qq.com/miniprogram/dev/api/)

百度⽂档：[https://smartprogram.baidu.com/docs/develop/api/apilist/](https://smartprogram.baidu.com/docs/develop/api/apilist/)

⽀付宝⽂档：[https://opendocs.alipay.com/mini/api](https://opendocs.alipay.com/mini/api)



相似内容：

- 均有原生组件和 webview 中渲染的组件
- ⼤部分配置和项⽬结构（app.json/app.js）都相同，甚至之前出现了支付宝小程序文档直接拷贝微信小程序文档的情况
- 他们都支持第三方平台（TP），来对用户授权的小程序进行操作，例如微信开发者平台，可以通过 sass 软件操作小程序的发布

不同的内容：

- 部分 API 名称和参数不同，例如各自使用不同的全局对象下的方法（wx/swan/my）
- 不同平台侧重的能力不同：
  - 支付宝侧重商家侧，创建的默认为企业用户，同时可以开启支付，使用一些支付宝内部的端能力
  - 百度小程序更侧重流量相关获取，我们可以通过设置自然搜索、提交信息流等手段，增加小程序的曝光率。同时 API 中有很多 AI 能力内置，让我们在使用 AI 上面更加得心应手
  - 微信小程序更侧重基础能力，推广上也增加了搜索快速展示的按钮等等
- 只有微信小程序⽀持个人申请使⽤，百度/⽀付宝仅⽀持企业使⽤

小程序之间的差异具体体现在 api 的差异当中，目前各家的小程序在运行时的差异已经非常小了，底层功能都已经非常稳定。书写小程序代码的过程中只需要注意对应 API 的使用即可



对于语法来说，其实多家小程序大同小异，都是使用类似 html 的模板语法 + 对应的样式文件 + 对应的逻辑脚本即可。每个小程序都需要实例化 App，每个页面都需要实例化，每个页面都需要实例化 Page，最终通过 setData 触发的数据更新从而渲染页面内容

### 小程序框架对比

对于开发者来说，应对多端小程序的开发是比较麻烦的，所以社区出现很多一次书写，多端运行的小程序开发框架。

- kbone：微信官方推出的一个框架，任何语言书写的框架都能直接使用
- mpvue：mpvue 是一个通过 vue 进行开发，同时支持多端的框架。目前支持微信、百度、头条和支付宝小程序
- remax：remax 是由阿里推出的一款小程序制作框架，能同时运行在微信小程序/支付宝小程序/字节跳动小程序当中
- taro：taro 目前支持微信/百度/支付宝/百度小程序和 h5，算是目前支持的平台最多也在持续维护的一个框架平台。它也是一套遵循 React 语法规范的 多端开发解决方案。通过 Taro 的编译工具，将源代码分别编译出可以在不同端(微信/百度/支付宝/字节跳动/QQ/京东小程序、快应 用、H5、React-Native 等)运行的代码

### kbone

kbone 是由腾讯发布的一款解决微信小程序和 web 端同构的框架

- github 地址: [https://github.com/Tencent/kbone](https://github.com/Tencent/kbone)

传统的开发小程序与 web 应用，因为小程序与 web 开发之间有较大区别，代码难以复用。这类同构框架，总结起来就是写一次代码，同时运行在微信小程序端和浏览器端

lerna 优势

- 比如：改了一个模块的版本号，就得去另一个模块里修改对应版本号。使用 lerna 就可以把不同版本挪到一起去，之后通过 lerna.json 维护

#### 仓库内容

通过 lerna 管理的 kbone 仓库，主要分为以下几部分内容

- kbone-cli: 命令行工具。主要在于初始化一些参数的配置相关的内容
- miniprogram-element: （重要）用于在运行时将 html 内容转化为小程序的内置组件以及一些基础模版部分
- miniprogram-render: （重要）在小程序中模拟的一些 DOM/BOM 环境的内容，例如window/location/history/navigator... 的浏览器环境下的对象方法。document.getElementByld 等方法，事件模型等内容。
- mp-webpack-plugin: （重要）主要处理一些小程序基本骨架，reset css 等内容
- reduce-loader:一个 webpack loader 来处理一些无用的代码
- vue-cli-plugin-kbone: vue-cli 的插件，这样就能在 vuecli 初始化的项目中来直接使用 kbone
- vue-improve-loader: 用于精简 vue 项目中 DOM 树结构的 webpack loader

#### miniprogram-element

`subtree.wxml`

```html
<template name="subtree">
  <block wx:for="{{childNodes}}" wx:key="nodeId">
    <view wx:if="{{item.type === 'view'}}">{{item.value}}</view>
    <text wx:if="{{item.type === 'text'}}">{{item.value}}</text>
    <button wx:if="{{item.type === 'button'}}" size="{{item.size}}">{{item.value}}</button>
  </block>
</template>
```

`pages/index/index.wxml`

```html
<import src="../../subtree.wxml" />
<template is="subtree" data="{{childNodes}}" />
```

#### logger.js

```js
const chalk = require('chalk')

exports.info = function (type, message) {
  console.log(`${chalk.bold.magenta(type)}: ${message}`)
}
exports.error = function (message) {
  console.log(chalk.red(message))
  process.exit(1)
}
exports.success = function (message) {
  console.log(chalk.green(message))
}
```



### mpvue

mpvue 是一个通过 vue 进行开发，同时支持多端的框架。目前支持 微信、百度、头条和支付宝小程序。它在运行时还依赖了部分 vue.runtime.js 的代码

特点

- mpvue 保留了 vue.runtime 核心方法，无缝继承了 Vuejs 的基础能力
- mpvue-template-compiler 提供了将vue的模板语法转换到小程序的 wxml 语法的能力
- 修改了 vue 的建构配置，使之构建出符合小程序项目 结构的代码式:json/wxml/wxss/js 文件
